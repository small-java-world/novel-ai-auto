/**
 * 【設定ファイル】: Storage/Download Compatibility Handler の設定値を一元管理
 * 【管理方針】: マジックナンバーを排除し、調整可能な設定値として外部化
 * 【保守性向上】: 設定変更時の影響範囲を限定し、メンテナンスを容易にする
 * 🟢 信頼性レベル: 高（テストケースとGreenフェーズ実装から抽出した確定値）
 */

/**
 * ダウンロード処理関連の設定定数
 * 【設定根拠】: テストケースとGreenフェーズ実装で使用されていた値を集約
 */
export const STORAGE_DOWNLOAD_CONFIG = {
  /**
   * ログ管理設定
   * 【ログ上限】: chrome.storage.local に保存するログエントリの最大件数
   * 【根拠】: TC-072-201 ログローテーション要件に基づく
   */
  LOG_LIMIT: 500,

  /**
   * リトライ処理設定
   * 【最大リトライ遅延】: ダウンロード失敗時のリトライ遅延の上限値（ミリ秒）
   * 【根拠】: TC-072-202 リトライ遅延境界値テストに基づく
   */
  MAX_RETRY_DELAY: 2000,

  /**
   * 【基本リトライ遅延】: リトライ計算の基準となる遅延時間（ミリ秒）
   * 【根拠】: Greenフェーズ実装の `500 * 2` 計算から抽出
   */
  RETRY_BASE_DELAY: 500,

  /**
   * 【リトライ遅延倍率】: 指数バックオフ計算で使用する倍率
   * 【根拠】: Greenフェーズ実装の `500 * 2` 計算から抽出
   */
  RETRY_MULTIPLIER: 2,

  /**
   * ファイル名処理設定
   * 【最大ファイル名長】: サニタイズ後のファイル名の最大文字数
   * 【根拠】: 一般的なファイルシステム制限（NTFS, ext4, APFS等）に基づく
   */
  MAX_FILENAME_LENGTH: 255,

  /**
   * 【デフォルト拡張子】: 拡張子が欠落した場合に自動付与される拡張子
   * 【根拠】: TC-072-203 ファイル名サニタイズテストで期待される形式
   */
  DEFAULT_EXTENSION: '.png',
} as const;

/**
 * エラーメッセージの定数定義
 * 【メッセージ一元化】: エラーメッセージの一貫性確保と翻訳対応準備
 * 【根拠】: テストケースで期待されるエラーメッセージ文言に基づく
 */
export const ERROR_MESSAGES = {
  /**
   * 権限関連エラーメッセージ
   */
  PERMISSION_DENIED: 'ダウンロード権限が拒否されました',
  PERMISSION_API_ERROR: '権限確認中にエラーが発生しました',

  /**
   * ダウンロード関連エラーメッセージ
   */
  DOWNLOAD_FAILED: 'ダウンロードに失敗しました',
  INVALID_INPUT: '不正な入力パラメータです',

  /**
   * ログ関連メッセージ
   */
  LOG_ERROR: 'ログ記録に失敗しました',
} as const;

/**
 * ログレベル定数
 * 【ログレベル標準化】: ログエントリの分類を統一
 * 【根拠】: TC-072-201 で期待されるログエントリ構造に基づく
 */
export const LOG_LEVELS = {
  INFO: 'INFO',
  ERROR: 'ERROR',
} as const;

/**
 * ファイル名サニタイズ用の正規表現パターン
 * 【パターン一元化】: ファイル名検証ロジックの一貫性確保
 * 【セキュリティ強化】: パストラバーサル攻撃等の防止
 */
export const FILENAME_PATTERNS = {
  /**
   * 【不正文字パターン】: Windows/Mac/Linuxで問題となる文字
   * 【参考】: OWASP ファイル名検証ガイドライン
   */
  INVALID_CHARS: /[<>:"/\\|?*]/g,

  /**
   * 【空白文字パターン】: 連続する空白文字
   * 【用途】: ファイル名の正規化処理
   */
  WHITESPACE: /\s+/g,

  /**
   * 【有効拡張子パターン】: 許可される画像ファイル拡張子
   * 【根拠】: TC-072-203 で期待される拡張子形式
   */
  VALID_EXTENSIONS: /\.(png|jpg|jpeg|gif|webp)$/i,
} as const;
