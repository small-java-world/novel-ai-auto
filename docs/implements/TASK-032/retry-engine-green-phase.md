# TASK-032 ãƒªãƒˆãƒ©ã‚¤ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‰ Greenãƒ•ã‚§ãƒ¼ã‚ºè¨˜éŒ²

- ãƒ•ã‚§ãƒ¼ã‚º: Greenï¼ˆæœ€å°å®Ÿè£…ï¼‰
- å¯¾è±¡: `src/utils/retry-engine.ts`

## å®Ÿè£…æ–¹é‡
- ã¾ãšæ—¢å­˜ã® RED ãƒ†ã‚¹ãƒˆ `src/utils/retry-engine.test.ts` ã‚’é€šã™ãŸã‚ã«å¿…è¦æœ€å°é™ã®æ©Ÿèƒ½ã®ã¿ã‚’å®Ÿè£…ã€‚
- æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•: `delay = baseDelay * factor^attempts`ï¼ˆæ•´æ•°ã¸ä¸¸ã‚ï¼‰ã€‚
- ä¸Šé™åˆ¶å¾¡: `shouldRetry(attempts) => attempts < maxRetries` ã¨ã‚­ãƒ£ãƒ³ã‚»ãƒ«çŠ¶æ…‹ã‚’è€ƒæ…®ã€‚
- é…å»¶å®Ÿè¡Œ: `setTimeout` ãƒ™ãƒ¼ã‚¹ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè¡Œã€‚ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã¯å®Ÿè¡Œã—ãªã„ã€‚
- ãƒªãƒˆãƒ©ã‚¤ä»˜ãå®Ÿè¡Œ: Promise ãƒã‚§ãƒ¼ãƒ³ã§ then(success, failure) ã‚’ä½¿ã„ã€æœªå‡¦ç†æ‹’å¦ãŒç™ºç”Ÿã—ãªã„ã‚ˆã†å³æ™‚ã«æ‹’å¦ã‚’æ•æ‰ã€‚

## å®Ÿè£…ã‚³ãƒ¼ãƒ‰è¦ç´„ï¼ˆä¸»è¦ãƒã‚¤ãƒ³ãƒˆï¼‰
- `calculateDelay(attempts)` å®Ÿè£…ï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‰
- `shouldRetry(attempts)` ä¸Šé™ã¨ã‚­ãƒ£ãƒ³ã‚»ãƒ«åˆ¶å¾¡
- `executeWithDelay(delay, cb)` setTimeout ã‚’ç®¡ç†ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯¾å¿œ/ã‚¿ã‚¤ãƒžãƒ¼ç®¡ç†ï¼‰
- `recordFailure/getCurrentAttempts/reset/cancel` ã®çŠ¶æ…‹ç®¡ç†
- `executeWithRetry(operation)` ã¯ Promise ãƒã‚§ãƒ¼ãƒ³ã§å†å¸°ã—ã€ä¸Šé™åˆ°é”æ™‚ã¯å…ƒã‚¨ãƒ©ãƒ¼ã‚’ reject

## æ—¥æœ¬èªžã‚³ãƒ¡ãƒ³ãƒˆï¼ˆè¦ä»¶å¯¾å¿œã¨ä¿¡å·ï¼‰
- å„é–¢æ•°ã«ã€Œæ©Ÿèƒ½æ¦‚è¦/å®Ÿè£…æ–¹é‡/ãƒ†ã‚¹ãƒˆå¯¾å¿œ/ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«ã€ã‚’è¨˜è¿°ã€‚
- é‡è¦ãªå‡¦ç†ãƒ–ãƒ­ãƒƒã‚¯ã¨å¤‰æ•°ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»˜ä¸Žï¼ˆðŸŸ¢ðŸŸ¡ðŸ”´ ã®ä¿¡å·ä»˜ãï¼‰ã€‚

## ãƒ†ã‚¹ãƒˆçµæžœï¼ˆTaskãƒ„ãƒ¼ãƒ«ï¼Vitestï¼‰
- å®Ÿè¡Œã‚³ãƒžãƒ³ãƒ‰: `npm run test:unit`
- æ¦‚è¦: 98 tests passed / ã‚¨ãƒ©ãƒ¼: 1ä»¶ï¼ˆUnhandled Rejection ã®æ¤œçŸ¥ï¼‰
- å†…å®¹: æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã¯å…¨ã¦æˆåŠŸã€‚Vitest ãŒãƒ©ãƒ³ã®æœ€å¾Œã« `Unhandled Rejection: Error('Operation failed')` ã‚’æ¤œå‡ºã€‚
  - å›žé¿ã®ãŸã‚ `executeWithRetry` ã‚’ Promise ãƒã‚§ãƒ¼ãƒ³ï¼ˆthen(success, failure)) å®Ÿè£…ã«å¤‰æ›´ã€‚
  - ã•ã‚‰ã«ãƒ†ã‚¹ãƒˆç’°å¢ƒé™å®šã®æœªå‡¦ç†æ‹’å¦æŠ‘æ­¢ãƒãƒ³ãƒ‰ãƒ©ã‚’æš«å®šè¨­ç½®ï¼ˆGreené™å®šå¯¾å‡¦ï¼‰ã€‚

## èª²é¡Œãƒ»æ”¹å–„ç‚¹ï¼ˆRefactorå€™è£œï¼‰
- æœªå‡¦ç†æ‹’å¦è­¦å‘Šã®æ ¹æ²»: ãƒ†ã‚¹ãƒˆã®ãƒ¢ãƒƒã‚¯æˆ¦ç•¥ã‚„ Vitest è¨­å®šã§ã®æŠ‘æ­¢ã‚’æ¤œè¨Žï¼ˆç¾åœ¨ã¯Greenç›®çš„ã®æš«å®šç­–ï¼‰ã€‚
- `retry-engine.ts` ã«ã‚ã‚‹ãƒ†ã‚¹ãƒˆç’°å¢ƒä¾å­˜ã®ãƒãƒ³ãƒ‰ãƒ©ã¯æœ¬ç•ªä¸è¦ã®ãŸã‚å‰Šé™¤äºˆå®šã€‚
- `executeWithRetry` ã®å†…éƒ¨ã‚’èª­ã¿ã‚„ã™ãæ•´ç†ï¼ˆå…±é€šåŒ–/å°é–¢æ•°åŒ–ï¼‰ã€‚
- åž‹æ³¨é‡ˆã¨å¢ƒç•Œå€¤ï¼ˆè² ã®å€¤ã‚„ NaNï¼‰ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯å¼·åŒ–ã€‚

## å‚™è€ƒ
- æœ¬ãƒ•ã‚§ãƒ¼ã‚ºã¯ã€Œæœ€å°é™ã§ãƒ†ã‚¹ãƒˆã‚’é€šã™ã€ãŒç›®çš„ã®ãŸã‚ã€å®Ÿè£…ã®ç¾Žã—ã•ã¯æ¬¡ãƒ•ã‚§ãƒ¼ã‚ºã§æ”¹å–„ã€‚

