# TASK-100 ローカルファイル選択機能 - TDDテストケース一覧

## 機能概要

**【機能名】**: TASK-100 ローカルファイル選択機能

ユーザーがローカルファイルシステムからプロンプトファイル（.naiprompts または .json）を選択・読み込み、既存のconfig/prompts.jsonと同様にプリセットとして使用できる機能のテストケース定義。

## 開発言語・フレームワーク

- **プログラミング言語**: TypeScript
  - **言語選択の理由**: 既存プロジェクトとの一貫性、型安全性によるバグ防止
  - **テストに適した機能**: インターフェース型検証、コンパイル時エラー検出
- **テストフレームワーク**: Vitest
  - **フレームワーク選択の理由**: 既存プロジェクトで採用済み、Chrome Extension APIモック対応
  - **テスト実行環境**: Node.js + jsdom、Chrome Extension APIモック環境
- 🟢 **青信号**: 既存プロジェクトの技術スタックとの整合性確認済み

## テストケース一覧

### 1. 正常系テストケース（基本的な動作）

#### TC-001-001: 有効なJSONプロンプトファイルの読み込み成功
- **テスト名**: 有効なJSONファイルからプロンプトデータの正常読み込み
  - **何をテストするか**: .jsonファイルの選択・読み込み・パース・検証の一連の処理
  - **期待される動作**: ファイル内容がPromptData[]形式で正常に読み込まれ、UIに反映される
- **入力値**:
  ```json
  [
    {
      "name": "美しい風景",
      "prompt": "beautiful landscape, mountains, sunset",
      "negative": "ugly, low quality",
      "parameters": {"steps": 28, "cfgScale": 7}
    }
  ]
  ```
  - **入力データの意味**: 標準的なプロンプトデータ形式、既存のconfig/prompts.jsonと互換
- **期待される結果**: PromptData[]配列が返され、UI上でプリセット選択可能
  - **期待結果の理由**: 既存のプリセット読み込み機能（TASK-041）と同様の動作保証
- **テストの目的**: 基本的なファイル読み込み機能の動作確認
  - **確認ポイント**: FileReader API使用、JSON.parse成功、型検証通過、UI統合
- 🟡 **黄信号**: 既存実装パターンからの妥当な推測

#### TC-001-002: .naipromptsファイルの読み込み成功
- **テスト名**: .naiprompts拡張子ファイルの正常読み込み
  - **何をテストするか**: .naiprompts拡張子のファイル受け入れと処理
  - **期待される動作**: .json以外の拡張子でも同じ形式であれば正常読み込み
- **入力値**: 同一内容のファイルで拡張子が.naiprompts
  - **入力データの意味**: 将来的な専用ファイル形式に対応する拡張性確保
- **期待される結果**: .jsonファイルと同様の処理結果
  - **期待結果の理由**: ファイル内容による判定、拡張子に依存しない設計
- **テストの目的**: 複数ファイル形式対応の確認
  - **確認ポイント**: 拡張子フィルタリング、内容ベース判定
- 🟡 **黄信号**: 要件定義書からの推測

#### TC-001-003: 複数プリセット含有ファイルの読み込み
- **テスト名**: 複数のプロンプトデータを含むファイルの一括読み込み
  - **何をテストするか**: 配列形式での複数プリセット同時読み込み機能
  - **期待される動作**: 全てのプリセットが個別に認識され、リストに追加される
- **入力値**: 5個のPromptDataを含む配列
  - **入力データの意味**: 実用的なプロンプトコレクションのサイズ想定
- **期待される結果**: 5個のプリセットが全て読み込まれ、UI上で選択可能
  - **期待結果の理由**: バッチ処理効率性、ユーザビリティ向上
- **テストの目的**: 複数データ処理の正確性確認
  - **確認ポイント**: 配列処理、重複チェック、順序保持
- 🟡 **黄信号**: 要件定義書からの推測

### 2. 異常系テストケース（エラーハンドリング）

#### TC-002-001: ファイルサイズ制限超過エラー
- **テスト名**: 10MB超過ファイルの適切なエラーハンドリング
  - **エラーケースの概要**: ファイルサイズが制限を超えた場合の検出と処理
  - **エラー処理の重要性**: メモリ枯渇防止、Chrome Extension制約遵守
- **入力値**: 10MB+1バイトのダミーファイル
  - **不正な理由**: システムリソース保護、パフォーマンス制約
  - **実際の発生シナリオ**: 大規模プロンプトコレクション、画像データ誤混入
- **期待される結果**: 明確なエラーメッセージ「ファイルサイズが制限(10MB)を超えています」
  - **エラーメッセージの内容**: ユーザーが対処方法を理解できる具体的な内容
  - **システムの安全性**: メモリリーク防止、アプリケーション継続動作
- **テストの目的**: サイズ制約のセキュリティとパフォーマンス保護
  - **品質保証の観点**: システム安定性、ユーザーエクスペリエンス向上
- 🟢 **青信号**: 要件定義書の制約条件に明記

#### TC-002-002: 不正なJSON形式のエラーハンドリング
- **テスト名**: JSON構文エラーファイルの適切な処理
  - **エラーケースの概要**: JSON.parse失敗時のエラー検出と復旧
  - **エラー処理の重要性**: XSS攻撃防止、アプリケーション異常終了防止
- **入力値**: `{"invalid": json syntax}` (クォート不整合)
  - **不正な理由**: JSON仕様違反、パース不可能
  - **実際の発生シナリオ**: ユーザーの手動編集ミス、外部ツール出力エラー
- **期待される結果**: 「ファイル形式が不正です。JSONファイルを確認してください」
  - **エラーメッセージの内容**: 技術的すぎず、対処可能な案内
  - **システムの安全性**: 例外捕捉、アプリケーション継続実行
- **テストの目的**: 構文エラー耐性とセキュリティ確保
  - **品質保証の観点**: データ検証強化、ユーザーフレンドリーなエラー処理
- 🟢 **青信号**: セキュリティ要件（NFR-102）に明記

#### TC-002-003: 必須フィールド欠如データの検証エラー
- **テスト名**: PromptData形式不適合データの検証エラー
  - **エラーケースの概要**: 必須フィールド（name, prompt）が不足している場合
  - **エラー処理の重要性**: データ整合性確保、UI表示エラー防止
- **入力値**: `[{"prompt": "test"}]` (nameフィールド欠如)
  - **不正な理由**: PromptData インターフェース違反
  - **実際の発生シナリオ**: 異なるツール出力、手動作成ミス
- **期待される結果**: 「プリセット名(name)が設定されていないデータがあります」
  - **エラーメッセージの内容**: 具体的な不足項目を示す
  - **システムの安全性**: 不完全データの拒否、UI整合性維持
- **テストの目的**: データ型検証とスキーマ遵守確認
  - **品質保証の観点**: 型安全性確保、データ品質維持
- 🟢 **青信号**: 型定義（src/types.ts）のPromptDataインターフェース準拠

#### TC-002-004: ファイル読み込み失敗時のエラーハンドリング
- **テスト名**: FileReader APIエラー時の適切な処理
  - **エラーケースの概要**: ブラウザレベルでのファイル読み込み失敗
  - **エラー処理の重要性**: システムレベルエラーの適切な伝達
- **入力値**: 読み込み権限のないファイル（モック）
  - **不正な理由**: ファイルシステム権限、ブラウザセキュリティ制約
  - **実際の発生シナリオ**: ファイル使用中、権限不足、ハードウェア障害
- **期待される結果**: 「ファイルの読み込みに失敗しました。ファイルの状態を確認してください」
  - **エラーメッセージの内容**: システムエラーをユーザー向けに変換
  - **システムの安全性**: 低レベルエラーの適切な処理
- **テストの目的**: FileReader API異常時の安定動作確認
  - **品質保証の観点**: システム堅牢性、エラー伝播防止
- 🟡 **黄信号**: Chrome Extension制約からの推測

### 3. 境界値テストケース（最小値、最大値、null等）

#### TC-003-001: ファイルサイズ制限境界値テスト（10MB丁度）
- **テスト名**: 10MB丁度のファイルサイズでの動作確認
  - **境界値の意味**: システム制約の正確な境界での動作保証
  - **境界値での動作保証**: 制限値丁度での正常処理確認
- **入力値**: 10MB * 1024 * 1024バイト丁度のファイル
  - **境界値選択の根拠**: 制約条件の上限値での動作確認
  - **実際の使用場面**: 大型プロンプトコレクション、制限ギリギリの利用
- **期待される結果**: 正常な読み込み完了、エラーなし
  - **境界での正確性**: サイズ判定の精密性確認
  - **一貫した動作**: 境界値での処理の一貫性
- **テストの目的**: サイズ制限境界での正確な判定確認
  - **堅牢性の確認**: 境界条件での安定動作
- 🟢 **青信号**: 制約条件に明記された数値

#### TC-003-002: 空ファイルの処理
- **テスト名**: 0バイトファイルの適切な処理
  - **境界値の意味**: 最小ファイルサイズでの動作
  - **境界値での動作保証**: 空データでのエラーハンドリング
- **入力値**: 0バイトの空ファイル
  - **境界値選択の根拠**: ファイルサイズの最小値
  - **実際の使用場面**: ファイル作成途中、誤送信
- **期待される結果**: 「ファイルにデータが含まれていません」エラー
  - **境界での正確性**: 空データ検出の正確性
  - **一貫した動作**: 他の無効データと同様の処理
- **テストの目的**: 最小入力値での適切なエラー処理確認
  - **堅牢性の確認**: 極端な条件下での安定性
- 🟡 **黄信号**: エッジケース処理からの推測

#### TC-003-003: 単一プリセットファイルの処理
- **テスト名**: 最小構成（1個のプリセット）での動作確認
  - **境界値の意味**: 最小有効データでの処理確認
  - **境界値での動作保証**: 配列の最小要素数での動作
- **入力値**: 1個のPromptDataを含む配列
  - **境界値選択の根拠**: 有効データの最小単位
  - **実際の使用場面**: シンプルなプリセット、テスト用途
- **期待される結果**: 1個のプリセットが正常に読み込まれる
  - **境界での正確性**: 配列処理の最小ケース確認
  - **一貫した動作**: 複数要素と同じ処理フロー
- **テストの目的**: 最小有効データでの処理確認
  - **堅牢性の確認**: 配列処理の境界値動作
- 🟡 **黄信号**: データ構造からの推測

#### TC-003-004: 最大長プロンプトテキストの処理
- **テスト名**: NovelAI制限ギリギリのプロンプト長での動作
  - **境界値の意味**: プロンプトテキスト長の実用限界
  - **境界値での動作保証**: 文字数制限近辺での安定処理
- **入力値**: 2000文字程度の長大プロンプト
  - **境界値選択の根拠**: NovelAI実用限界近辺の値
  - **実際の使用場面**: 詳細な画像指定、複雑なプロンプト合成
- **期待される結果**: 正常読み込み、必要に応じて警告表示
  - **境界での正確性**: 長文処理の性能確認
  - **一貫した動作**: 文字数に関わらず同じ処理品質
- **テストの目的**: 長文プロンプトでの性能と安定性確認
  - **堅牢性の確認**: メモリ使用量、処理時間の妥当性
- 🟡 **黄信号**: NovelAI制約からの推測

## テストケース実装時の日本語コメント指針

### テストケース開始時のコメント

```javascript
// 【テスト目的】: [このテストで何を確認するかを日本語で明記]
// 【テスト内容】: [具体的にどのような処理をテストするかを説明]
// 【期待される動作】: [正常に動作した場合の結果を説明]
// 🟢🟡🔴 この内容の信頼性レベルを記載
```

### Given（準備フェーズ）のコメント

```javascript
// 【テストデータ準備】: [なぜこのデータを用意するかの理由]
// 【初期条件設定】: [テスト実行前の状態を説明]
// 【前提条件確認】: [テスト実行に必要な前提条件を明記]
```

### When（実行フェーズ）のコメント

```javascript
// 【実際の処理実行】: [どの機能/メソッドを呼び出すかを説明]
// 【処理内容】: [実行される処理の内容を日本語で説明]
// 【実行タイミング】: [なぜこのタイミングで実行するかを説明]
```

### Then（検証フェーズ）のコメント

```javascript
// 【結果検証】: [何を検証するかを具体的に説明]
// 【期待値確認】: [期待される結果とその理由を説明]
// 【品質保証】: [この検証がシステム品質にどう貢献するかを説明]
```

### 各expectステートメントのコメント

```javascript
// 【検証項目】: [この検証で確認している具体的な項目]
// 🟢🟡🔴 この内容の信頼性レベルを記載
expect(result.validPaths).toHaveLength(2); // 【確認内容】: 有効なパスが正確に2つ検出されることを確認
expect(result.invalidPaths).toContain('nonexistent.json'); // 【確認内容】: 存在しないファイルが無効パスとして適切に分類されることを確認
```

### セットアップ・クリーンアップのコメント

```javascript
beforeEach(() => {
  // 【テスト前準備】: [各テスト実行前に行う準備作業の説明]
  // 【環境初期化】: [テスト環境をクリーンな状態にする理由と方法]
});

afterEach(() => {
  // 【テスト後処理】: [各テスト実行後に行うクリーンアップ作業の説明]
  // 【状態復元】: [次のテストに影響しないよう状態を復元する理由]
});
```

## 完了時刻

2025-09-20 TDDテストケース洗い出しフェーズ完了

---

**次のお勧めステップ**: `/tdd-red TASK-100` でRedフェーズ（失敗テスト作成）を開始します。