# TDDテストケースの洗い出し - TASK-102

**【機能名】**: TASK-102 新フォーマット対応・メタデータ管理

## 事前準備

✅ **TDDコンテキスト準備完了**: 要件定義書、既存実装（TASK-100/101）、アーキテクチャ設計を分析済み

## 開発言語・フレームワーク

- **プログラミング言語**: TypeScript
  - **言語選択の理由**: 型安全性により複雑なメタデータ構造の検証が容易、既存実装との統合性
  - **テストに適した機能**: strict modeでの型チェック、interface定義による明確な契約
- **テストフレームワーク**: Vitest
  - **フレームワーク選択の理由**: 既存プロジェクトで採用済み、ES Module対応、高速実行
  - **テスト実行環境**: Node.js環境でのChrome Extension API モック
- 🟢 既存技術スタックとの統合性により確実

## 1. 正常系テストケース（基本的な動作）

### 1.1 新フォーマット読み込み（REQ-102-001）

#### TC001: 完全な新フォーマットファイルの読み込み

- **テスト名**: 完全なメタデータを持つ新フォーマット（v1.0）ファイルの正常読み込み
  - **何をテストするか**: PromptFileV1インターフェースに完全準拠したファイルの読み込み処理
  - **期待される動作**: メタデータとプリセットデータの完全な抽出と型変換
- **入力値**:
  ```typescript
  {
    version: "1.0",
    metadata: {
      name: "テストプリセット集",
      description: "テスト用のプリセットコレクション",
      author: "テストユーザー",
      created: "2024-01-01T00:00:00Z",
      modified: "2024-01-02T00:00:00Z",
      tags: ["fantasy", "character", "landscape"],
      license: "CC BY 4.0",
      source: "https://example.com"
    },
    commonPrompts: {
      base: "high quality, masterpiece",
      negative: "low quality, blurry"
    },
    presets: [
      {
        name: "美しい風景",
        prompt: "beautiful landscape",
        negative: "ugly",
        parameters: { steps: 28, cfgScale: 7.0, sampler: "k_euler_ancestral" }
      }
    ]
  }
  ```

  - **入力データの意味**: 新フォーマットの全フィールドを含む完全なデータ構造
- **期待される結果**:
  ```typescript
  {
    success: true,
    metadata: MetadataDisplayResult,
    presets: PresetV1[],
    errors: [],
    warnings: []
  }
  ```

  - **期待結果の理由**: すべての必須・任意フィールドが適切に解析されるため
- **テストの目的**: 新フォーマットの基本的な読み込み機能の動作確認
  - **確認ポイント**: TypeScript型安全性、Unicode正規化、ISO 8601日付解析
- 🟢 EARS要件REQ-102-001と型定義に基づく確実なケース

#### TC002: commonPromptsが省略された新フォーマットの読み込み

- **テスト名**: commonPromptsフィールドが省略された新フォーマットファイルの読み込み
  - **何をテストするか**: 任意フィールドの省略に対する適切な処理
  - **期待される動作**: commonPromptsなしでも正常に処理される
- **入力値**: TC001から`commonPrompts`フィールドを除外
  - **入力データの意味**: 最小限の必須フィールドのみを含むケース
- **期待される結果**: `commonPrompts: undefined`として正常処理
  - **期待結果の理由**: TypeScript optional fieldの仕様に準拠
- **テストの目的**: 任意フィールドの処理確認
  - **確認ポイント**: 省略フィールドのデフォルト値処理
- 🟢 TypeScript仕様とPromptFileV1インターフェースに基づく

### 1.2 メタデータ表示・管理（REQ-102-002）

#### TC003: メタデータの画面表示

- **テスト名**: 読み込んだメタデータの画面表示機能
  - **何をテストするか**: MetadataDisplayResult形式での画面表示データ生成
  - **期待される動作**: HTMLエスケープ済みの安全な表示データ生成
- **入力値**: TC001のメタデータ部分
  - **入力データの意味**: 全フィールド含有の代表的なメタデータ
- **期待される結果**:
  ```typescript
  {
    name: "テストプリセット集",
    description: "テスト用のプリセットコレクション",
    author: "テストユーザー",
    dateCreated: "2024年1月1日",
    dateModified: "2024年1月2日",
    tags: ["fantasy", "character", "landscape"],
    license: "CC BY 4.0",
    source: "https://example.com"
  }
  ```

  - **期待結果の理由**: ISO 8601からユーザー可読形式への変換とHTMLエスケープ処理
- **テストの目的**: メタデータの安全な表示機能確認
  - **確認ポイント**: XSS防止、日時フォーマット、文字エンコーディング
- 🟢 セキュリティ要件とUI仕様に基づく

#### TC004: タグの表示と管理

- **テスト名**: タグリストの表示と選択機能
  - **何をテストするか**: タグ配列の表示とインタラクティブな選択処理
  - **期待される動作**: 重複除去済みのタグ一覧表示と選択状態管理
- **入力値**: `["fantasy", "character", "landscape", "fantasy"]`（重複含む）
  - **入力データの意味**: 実際のユーザーファイルで発生しうる重複タグ
- **期待される結果**: `["fantasy", "character", "landscape"]`（重複除去済み）
  - **期待結果の理由**: REQ-102-104の重複タグ除去要件
- **テストの目的**: タグ管理機能の正常動作確認
  - **確認ポイント**: 重複除去、Unicode正規化、選択状態保持
- 🟢 REQ-102-104とタグ管理仕様に基づく

### 1.3 タグベースフィルタリング（REQ-102-005）

#### TC005: 単一タグでのフィルタリング

- **テスト名**: 単一タグを選択した場合のプリセット絞り込み
  - **何をテストするか**: 指定タグを含むプリセットのみの抽出
  - **期待される動作**: タグマッチング条件での高速フィルタリング（≤100ms）
- **入力値**:
  - 選択タグ: `["fantasy"]`
  - プリセット配列: 3個（1個がfantasyタグ含有）
  - **入力データの意味**: 典型的な単一タグ検索シナリオ
- **期待される結果**:
  ```typescript
  {
    filteredPresets: [/* fantasyタグ含有プリセット */],
    matchCount: 1,
    appliedTags: ["fantasy"]
  }
  ```

  - **期待結果の理由**: タグ配列の部分文字列マッチング機能
- **テストの目的**: 基本的なフィルタリング機能の動作確認
  - **確認ポイント**: 性能要件（100ms以内）、マッチング精度、結果一貫性
- 🟢 NFR-102-002性能要件とフィルタリング仕様に基づく

#### TC006: 複数タグでのフィルタリング（AND条件）

- **テスト名**: 複数タグを選択した場合のAND条件フィルタリング
  - **何をテストするか**: すべての指定タグを含むプリセットのみの抽出
  - **期待される動作**: 交集合条件での厳密なマッチング
- **入力値**:
  - 選択タグ: `["fantasy", "character"]`
  - プリセット配列: 5個（2個が両方のタグ含有）
  - **入力データの意味**: 詳細な絞り込み検索シナリオ
- **期待される結果**: `matchCount: 2`の両方タグ含有プリセット
  - **期待結果の理由**: AND条件でのタグマッチング要件
- **テストの目的**: 複合条件でのフィルタリング精度確認
  - **確認ポイント**: AND論理演算の正確性、性能維持
- 🟢 フィルタリング仕様とデータフロー設計に基づく

### 1.4 既存形式との互換性（REQ-102-003）

#### TC007: レガシーJSON形式の自動変換

- **テスト名**: 旧JSON形式ファイルの新フォーマットへの自動変換
  - **何をテストするか**: LegacyPromptFile → PromptFileV1の変換処理
  - **期待される動作**: メタデータ不足部分のデフォルト値補完と変換（≤500ms）
- **入力値**:
  ```typescript
  {
    presets: [
      {
        name: '旧形式プリセット',
        prompt: 'old format prompt',
        negative: 'old negative',
        parameters: { steps: 20, cfgScale: 7.0, sampler: 'k_euler' },
      },
    ];
  }
  ```

  - **入力データの意味**: メタデータ未対応の既存プロンプトファイル
- **期待される結果**:
  ```typescript
  {
    success: true,
    convertedData: {
      version: "1.0",
      metadata: {
        name: "[ファイル名から生成]",
        description: "",
        author: "",
        created: "[変換時刻]",
        modified: "[変換時刻]",
        tags: []
      },
      presets: [/* 変換済みプリセット */]
    },
    warnings: ["メタデータが不足しているため、デフォルト値を設定しました"],
    errors: []
  }
  ```

  - **期待結果の理由**: REQ-102-101のデフォルト値設定要件
- **テストの目的**: レガシー形式との互換性確認
  - **確認ポイント**: 変換精度、デフォルト値適切性、性能要件（500ms以内）
- 🟢 REQ-102-101/102/103互換性要件に基づく

## 2. 異常系テストケース（エラーハンドリング）

### 2.1 ファイル形式エラー

#### TC008: JSON構文エラーの処理

- **テスト名**: 不正なJSON構文を含むファイルの処理
  - **エラーケースの概要**: JSON.parse()で解析できない不正な構文
  - **エラー処理の重要性**: ファイル破損や手動編集ミスから保護
- **入力値**: `'{"version": "1.0", "metadata": {'` (JSON不完全)
  - **不正な理由**: 閉じ括弧不足によるJSON構文違反
  - **実際の発生シナリオ**: 手動編集中の保存ミス、ファイル転送中の破損
- **期待される結果**:
  ```typescript
  {
    success: false,
    convertedData: undefined,
    warnings: [],
    errors: ["JSON構文エラー: line 1, unexpected token"]
  }
  ```

  - **エラーメッセージの内容**: 具体的な構文エラー位置とユーザー向け修正案
  - **システムの安全性**: アプリケーション継続実行、他機能への影響なし
- **テストの目的**: JSON構文エラーの適切なハンドリング確認
  - **品質保証の観点**: ユーザビリティ向上と堅牢性確保
- 🟢 既存エラーハンドリングパターンとJSON標準仕様に基づく

#### TC009: バージョン不一致エラーの処理

- **テスト名**: 未対応バージョンファイルの処理
  - **エラーケースの概要**: version "2.0"等の未知バージョン指定
  - **エラー処理の重要性**: 将来バージョンとの互換性確保
- **入力値**: `{ version: "2.0", metadata: {...}, presets: [...] }`
  - **不正な理由**: 現在対応可能なバージョンは "1.0" のみ
  - **実際の発生シナリオ**: 新バージョンファイルの旧バージョンアプリでの使用
- **期待される結果**:
  ```typescript
  {
    success: false,
    convertedData: undefined,
    warnings: ["バージョン2.0は未対応です"],
    errors: ["対応可能バージョン: 1.0"]
  }
  ```

  - **エラーメッセージの内容**: 現在対応バージョンの明示と代替案提示
  - **システムの安全性**: 予期しない動作の防止
- **テストの目的**: バージョン管理機能の確認
  - **品質保証の観点**: 前方互換性の制御と明確なエラー通知
- 🟢 REQ-102-103バージョン管理要件に基づく

### 2.2 データ検証エラー

#### TC010: 必須フィールド不足エラーの処理

- **テスト名**: 必須フィールド（name）が不足している場合の処理
  - **エラーケースの概要**: MetadataV1.nameフィールドの未定義
  - **エラー処理の重要性**: データ整合性確保とUI表示問題の防止
- **入力値**:
  ```typescript
  {
    version: "1.0",
    metadata: {
      description: "名前フィールドなし",
      author: "テストユーザー"
      // name フィールドが不足
    },
    presets: [...]
  }
  ```

  - **不正な理由**: nameフィールドは必須（1-100文字）だが未定義
  - **実際の発生シナリオ**: 手動作成時の記述漏れ、自動生成時のバグ
- **期待される結果**:
  ```typescript
  {
    success: true,
    convertedData: {
      metadata: {
        name: "[ファイル名から生成]",
        description: "名前フィールドなし",
        author: "テストユーザー",
        // 自動補完された値
      }
    },
    warnings: ["nameフィールドが不足しているため、ファイル名から生成しました"],
    errors: []
  }
  ```

  - **エラーメッセージの内容**: 自動修復内容の説明と継続利用可能の通知
  - **システムの安全性**: REQ-102-101のデフォルト値設定による安全な復旧
- **テストの目的**: 必須フィールド不足の自動修復機能確認
  - **品質保証の観点**: データ欠損に対する堅牢性とユーザビリティ
- 🟢 REQ-102-101デフォルト値設定要件に基づく

#### TC011: 文字数制限超過エラーの処理

- **テスト名**: メタデータフィールドの文字数制限超過
  - **エラーケースの概要**: name（1-100文字）、description（0-500文字）の上限超過
  - **エラー処理の重要性**: UI表示領域オーバーフローとストレージ制限の保護
- **入力値**:
  ```typescript
  {
    metadata: {
      name: "A".repeat(101), // 101文字（上限100文字超過）
      description: "B".repeat(501), // 501文字（上限500文字超過）
      author: "C".repeat(51) // 51文字（上限50文字超過）
    }
  }
  ```

  - **不正な理由**: 各フィールドの文字数制限を超過
  - **実際の発生シナリオ**: 長い説明文の貼り付け、自動生成時の制限未考慮
- **期待される結果**:
  ```typescript
  {
    success: true,
    convertedData: {
      metadata: {
        name: "A".repeat(100), // 100文字に切り詰め
        description: "B".repeat(500), // 500文字に切り詰め
        author: "C".repeat(50) // 50文字に切り詰め
      }
    },
    warnings: [
      "nameフィールドが100文字に切り詰められました",
      "descriptionフィールドが500文字に切り詰められました",
      "authorフィールドが50文字に切り詰められました"
    ],
    errors: []
  }
  ```

  - **エラーメッセージの内容**: 切り詰め実行の詳細と文字数制限の説明
  - **システムの安全性**: UI表示可能範囲内への自動調整
- **テストの目的**: 文字数制限の強制と警告機能確認
  - **品質保証の観点**: データ整合性維持とUI破綻防止
- 🟢 メタデータ文字数制約とUI設計仕様に基づく

### 2.3 セキュリティエラー

#### TC012: XSS攻撃パターンの検出と無害化

- **テスト名**: HTMLスクリプト注入攻撃の検出と無害化
  - **エラーケースの概要**: メタデータフィールドへのHTMLタグ/JavaScript注入
  - **エラー処理の重要性**: XSS攻撃防止とUI表示の安全性確保
- **入力値**:
  ```typescript
  {
    metadata: {
      name: "<script>alert('XSS')</script>悪意のあるプリセット",
      description: "<img src=x onerror=alert('XSS')>説明文",
      author: "<iframe src='javascript:alert(1)'></iframe>"
    }
  }
  ```

  - **不正な理由**: HTMLタグとJavaScriptコードを含む悪意のある入力
  - **実際の発生シナリオ**: 悪意のあるプリセットファイルの配布、共有ファイルの改ざん
- **期待される結果**:
  ```typescript
  {
    success: true,
    convertedData: {
      metadata: {
        name: "&lt;script&gt;alert('XSS')&lt;/script&gt;悪意のあるプリセット",
        description: "&lt;img src=x onerror=alert('XSS')&gt;説明文",
        author: "&lt;iframe src='javascript:alert(1)'&gt;&lt;/iframe&gt;"
      }
    },
    warnings: ["HTMLタグが無害化されました"],
    errors: []
  }
  ```

  - **エラーメッセージの内容**: セキュリティ処理実行の通知
  - **システムの安全性**: HTMLエスケープによる完全な無害化
- **テストの目的**: XSS攻撃防止機能の確認
  - **品質保証の観点**: セキュリティ要件の遵守とユーザー保護
- 🟢 セキュリティ要件REQ-102-401とXSS防止仕様に基づく

### 2.4 リソース制限エラー

#### TC013: ファイルサイズ制限超過エラーの処理

- **テスト名**: 10MB制限を超過するファイルの処理
  - **エラーケースの概要**: ファイルサイズが10MBを超過している場合
  - **エラー処理の重要性**: メモリ不足防止とシステム安定性確保
- **入力値**: 10MB + 1バイトのプリセットファイル
  - **不正な理由**: 既存制約の10MB制限を超過
  - **実際の発生シナリオ**: 大量プリセット集約ファイル、画像埋め込みファイル
- **期待される結果**:
  ```typescript
  {
    success: false,
    convertedData: undefined,
    warnings: [],
    errors: ["ファイルサイズが制限（10MB）を超過しています"]
  }
  ```

  - **エラーメッセージの内容**: 制限値の明示と分割提案
  - **システムの安全性**: メモリ使用量制御による安定動作
- **テストの目的**: ファイルサイズ制限機能の確認
  - **品質保証の観点**: システムリソース保護とパフォーマンス維持
- 🟢 既存ファイルサイズ制約とシステム安定性要件に基づく

#### TC014: タグ数制限超過エラーの処理

- **テスト名**: 20個を超えるタグが指定された場合の処理
  - **エラーケースの概要**: tags配列の要素数が20を超過
  - **エラー処理の重要性**: UI表示領域とフィルタリング性能の保護
- **入力値**:
  ```typescript
  {
    metadata: {
      tags: Array.from({ length: 25 }, (_, i) => `tag${i}`); // 25個のタグ
    }
  }
  ```

  - **不正な理由**: タグ数上限20個を超過
  - **実際の発生シナリオ**: 詳細分類の過度な適用、自動タグ生成の暴走
- **期待される結果**:
  ```typescript
  {
    success: true,
    convertedData: {
      metadata: {
        tags: Array.from({length: 20}, (_, i) => `tag${i}`) // 20個に切り詰め
      }
    },
    warnings: ["タグ数が20個に制限されました（元: 25個）"],
    errors: []
  }
  ```

  - **エラーメッセージの内容**: 切り詰め実行の詳細と制限理由
  - **システムの安全性**: フィルタリング性能維持と UI表示制限遵守
- **テストの目的**: タグ数制限機能の確認
  - **品質保証の観点**: パフォーマンス要件維持とUI設計制約遵守
- 🟡 要件定義書のタグ制限とパフォーマンス要件から妥当な推測

## 3. 境界値テストケース（最小値、最大値、null等）

### 3.1 メタデータフィールド文字数境界値

#### TC015: nameフィールドの最小値境界（1文字）

- **テスト名**: nameフィールドの最小有効値（1文字）での処理
  - **境界値の意味**: nameフィールドの下限値（1文字）での動作保証
  - **境界値での動作保証**: 1文字でも適切にUI表示される
- **入力値**:
  ```typescript
  {
    metadata: {
      name: 'A';
    }
  } // 1文字（最小有効値）
  ```

  - **境界値選択の根拠**: nameフィールドの仕様「1-100文字」の下限値
  - **実際の使用場面**: 簡潔な命名規則、略称使用時
- **期待される結果**:
  ```typescript
  { success: true, metadata: { name: "A" } }
  ```

  - **境界での正確性**: 1文字でも正常に処理・表示される
  - **一貫した動作**: 文字数検証で境界内として適切に扱われる
- **テストの目的**: 最小文字数境界での動作確認
  - **堅牢性の確認**: 極端に短い入力でも安定動作する
- 🟢 MetadataV1インターフェース仕様（1-100文字）に基づく

#### TC016: nameフィールドの最大値境界（100文字）

- **テスト名**: nameフィールドの最大有効値（100文字）での処理
  - **境界値の意味**: nameフィールドの上限値（100文字）での動作保証
  - **境界値での動作保証**: 100文字でもUI表示が適切に収まる
- **入力値**:
  ```typescript
  {
    metadata: {
      name: 'A'.repeat(100);
    }
  } // 100文字（最大有効値）
  ```

  - **境界値選択の根拠**: nameフィールドの仕様「1-100文字」の上限値
  - **実際の使用場面**: 詳細な説明を含む長い名前
- **期待される結果**:
  ```typescript
  { success: true, metadata: { name: "A".repeat(100) } }
  ```

  - **境界での正確性**: 100文字ちょうどで正常処理される
  - **一貫した動作**: UI表示領域内で適切にレンダリングされる
- **テストの目的**: 最大文字数境界での動作確認
  - **堅牢性の確認**: UI制限ギリギリでも安定表示される
- 🟢 MetadataV1インターフェース仕様とUI設計制約に基づく

#### TC017: descriptionフィールドの空文字境界（0文字）

- **テスト名**: descriptionフィールドの最小値（0文字、省略）での処理
  - **境界値の意味**: 任意フィールドの最小値（未設定）での動作
  - **境界値での動作保証**: 空文字でもエラーなく処理される
- **入力値**:
  ```typescript
  { metadata: { name: "テスト", description: "" } } // 0文字（最小値）
  ```

  - **境界値選択の根拠**: descriptionフィールドの仕様「0-500文字」の下限値
  - **実際の使用場面**: 説明不要なシンプルなプリセット
- **期待される結果**:
  ```typescript
  { success: true, metadata: { description: "" } }
  ```

  - **境界での正確性**: 空文字も有効な値として処理される
  - **一貫した動作**: UI表示で空欄として適切に表示される
- **テストの目的**: 任意フィールド最小値での動作確認
  - **堅牢性の確認**: 未入力状態でも安定動作する
- 🟢 MetadataV1インターフェース仕様（0-500文字）に基づく

#### TC018: descriptionフィールドの最大値境界（500文字）

- **テスト名**: descriptionフィールドの最大有効値（500文字）での処理
  - **境界値の意味**: 長文説明の上限値での動作保証
  - **境界値での動作保証**: 500文字でもUI表示とストレージが適切に処理
- **入力値**:
  ```typescript
  {
    metadata: {
      description: '詳細説明'.repeat(100);
    }
  } // 500文字
  ```

  - **境界値選択の根拠**: descriptionフィールドの仕様「0-500文字」の上限値
  - **実際の使用場面**: 詳細な使用方法や背景を含む説明文
- **期待される結果**:
  ```typescript
  { success: true, metadata: { description: "詳細説明".repeat(100) } }
  ```

  - **境界での正確性**: 500文字ちょうどで正常処理される
  - **一貫した動作**: UI表示領域で適切にスクロール表示される
- **テストの目的**: 最大説明文長での動作確認
  - **堅牢性の確認**: 長文でもパフォーマンス劣化なし
- 🟢 MetadataV1インターフェース仕様とUI設計制約に基づく

### 3.2 タグ数境界値

#### TC019: タグ配列の最小値境界（0個）

- **テスト名**: タグが1個も指定されていない場合の処理
  - **境界値の意味**: tagsフィールドの最小値（空配列）での動作
  - **境界値での動作保証**: タグなしでもフィルタリング機能が適切に動作
- **入力値**:
  ```typescript
  {
    metadata: {
      tags: [];
    }
  } // 0個（最小値）
  ```

  - **境界値選択の根拠**: tagsフィールドの仕様「0-20タグ」の下限値
  - **実際の使用場面**: 分類不要なプリセット、タグ付けなしファイル
- **期待される結果**:
  ```typescript
  {
    success: true,
    metadata: { tags: [] },
    filterResult: { filteredPresets: [/* すべて表示 */], matchCount: 0 }
  }
  ```

  - **境界での正確性**: 空配列でもフィルタリング処理が正常動作
  - **一貫した動作**: 「タグなし」として明確に認識される
- **テストの目的**: タグなし状態での機能確認
  - **堅牢性の確認**: フィルタリング機能がタグ不在でも安定動作
- 🟢 MetadataV1インターフェース仕様（0-20タグ）に基づく

#### TC020: タグ配列の最大値境界（20個）

- **テスト名**: タグが上限値（20個）指定された場合の処理
  - **境界値の意味**: tagsフィールドの上限値（20個）での動作保証
  - **境界値での動作保証**: 20個でもフィルタリング性能（≤100ms）を維持
- **入力値**:
  ```typescript
  {
    metadata: {
      tags: Array.from({ length: 20 }, (_, i) => `tag${i.toString().padStart(2, '0')}`);
    }
  } // 20個（最大有効値）
  ```

  - **境界値選択の根拠**: tagsフィールドの仕様「0-20タグ」の上限値
  - **実際の使用場面**: 詳細分類された複雑なプリセット
- **期待される結果**:
  ```typescript
  {
    success: true,
    metadata: { tags: [/* 20個すべて */] },
    filterPerformance: "≤100ms"
  }
  ```

  - **境界での正確性**: 20個すべてが正常に処理・表示される
  - **一貫した動作**: フィルタリング性能要件（100ms以内）を満たす
- **テストの目的**: 最大タグ数での性能確認
  - **堅牢性の確認**: 上限値でもパフォーマンス要件を満たす
- 🟢 MetadataV1インターフェース仕様とNFR-102-002性能要件に基づく

### 3.3 ファイルサイズ境界値

#### TC021: ファイルサイズ最小値境界（1バイト）

- **テスト名**: 最小ファイルサイズ（1バイト）での処理
  - **境界値の意味**: 読み込み可能な最小ファイルサイズでの動作
  - **境界値での動作保証**: 1バイトでも適切にエラー処理される
- **入力値**: `"{"` (1バイト、不完全なJSON)
  - **境界値選択の根拠**: ファイルサイズの物理的下限値
  - **実際の使用場面**: ファイル作成途中の誤保存、ネットワーク転送エラー
- **期待される結果**:
  ```typescript
  {
    success: false,
    errors: ["JSON構文エラー: 不完全なファイルです"]
  }
  ```

  - **境界での正確性**: 最小サイズでも適切にエラー検出される
  - **一貫した動作**: ファイルサイズに関係なく構文検証が動作
- **テストの目的**: 最小ファイルサイズでのエラー検出確認
  - **堅牢性の確認**: 極端に小さいファイルでも安全に処理
- 🟢 ファイル読み込み処理とJSON構文検証の基本仕様に基づく

#### TC022: ファイルサイズ上限境界（10MB）

- **テスト名**: ファイルサイズ上限値（10MB）での処理
  - **境界値の意味**: 許可される最大ファイルサイズでの動作保証
  - **境界値での動作保証**: 10MB以内でも読み込み性能（≤200ms）を維持
- **入力値**: 10MB - 1バイトの有効なプリセットファイル
  - **境界値選択の根拠**: 既存制約の10MB制限の上限値
  - **実際の使用場面**: 大量プリセットを含む統合ファイル
- **期待される結果**:
  ```typescript
  {
    success: true,
    loadPerformance: "≤200ms",
    metadata: { /* 正常読み込み結果 */ }
  }
  ```

  - **境界での正確性**: 上限値内で正常に読み込み処理される
  - **一貫した動作**: パフォーマンス要件（200ms以内）を満たす
- **テストの目的**: 最大ファイルサイズでの性能確認
  - **堅牢性の確認**: 上限値でもメモリ使用量とパフォーマンスが適切
- 🟢 ファイルサイズ制約とNFR-102-001性能要件に基づく

### 3.4 日時フォーマット境界値

#### TC023: ISO 8601日時の境界値処理

- **テスト名**: ISO 8601形式の境界値（最小/最大日時）での処理
  - **境界値の意味**: 有効なISO 8601日時の範囲境界での動作
  - **境界値での動作保証**: 極端な日時でも適切にパース・表示される
- **入力値**:
  ```typescript
  {
    metadata: {
      created: "1970-01-01T00:00:00Z", // Unix epoch最小値
      modified: "2038-01-19T03:14:07Z" // 32bit timestamp上限値
    }
  }
  ```

  - **境界値選択の根拠**: JavaScript Date型の安全な処理範囲
  - **実際の使用場面**: 古いファイルの移行、将来日時の設定ミス
- **期待される結果**:
  ```typescript
  {
    success: true,
    metadata: {
      dateCreated: "1970年1月1日",
      dateModified: "2038年1月19日"
    }
  }
  ```

  - **境界での正確性**: 境界値でも正確に日時変換される
  - **一貫した動作**: 人間可読形式への変換が一貫して動作
- **テストの目的**: 日時処理の境界値確認
  - **堅牢性の確認**: 極端な日時でも表示エラーが発生しない
- 🟢 ISO 8601標準とJavaScript Date型仕様に基づく

### 3.5 Unicode文字境界値

#### TC024: Unicode特殊文字の境界値処理

- **テスト名**: Unicode特殊文字（絵文字、CJK統合漢字）の処理
  - **境界値の意味**: Unicode文字セットの特殊範囲での動作保証
  - **境界値での動作保証**: 特殊文字でも文字数計算と表示が正確
- **入力値**:
  ```typescript
  {
    metadata: {
      name: "🎨✨魔法のプリセット集👑", // 絵文字+漢字
      tags: ["🌸春", "🍂秋", "❄️冬"] // 絵文字タグ
    }
  }
  ```

  - **境界値選択の根拠**: Unicode正規化とマルチバイト文字の処理確認
  - **実際の使用場面**: 国際化対応、絵文字を使った視覚的分類
- **期待される結果**:
  ```typescript
  {
    success: true,
    metadata: {
      name: "🎨✨魔法のプリセット集👑", // NFC正規化済み
      tags: ["🌸春", "🍂秋", "❄️冬"]
    }
  }
  ```

  - **境界での正確性**: Unicode正規化（NFC）が適切に実行される
  - **一貫した動作**: マルチバイト文字でも文字数制限が正確に適用
- **テストの目的**: Unicode処理の境界確認
  - **堅牢性の確認**: 特殊文字でも文字化けや処理エラーが発生しない
- 🟢 REQ-102-402のUnicode正規化要件と国際化対応に基づく

## テストケース実装時の日本語コメント指針

各テストケースの実装時には以下の日本語コメントを必ず含めてください：

### テストケース開始時のコメント

```typescript
// 【テスト目的】: [このテストで何を確認するかを日本語で明記]
// 【テスト内容】: [具体的にどのような処理をテストするかを説明]
// 【期待される動作】: [正常に動作した場合の結果を説明]
// 🟢🟡🔴 この内容の信頼性レベルを記載
```

### Given（準備フェーズ）のコメント

```typescript
// 【テストデータ準備】: [なぜこのデータを用意するかの理由]
// 【初期条件設定】: [テスト実行前の状態を説明]
// 【前提条件確認】: [テスト実行に必要な前提条件を明記]
```

### When（実行フェーズ）のコメント

```typescript
// 【実際の処理実行】: [どの機能/メソッドを呼び出すかを説明]
// 【処理内容】: [実行される処理の内容を日本語で説明]
// 【実行タイミング】: [なぜこのタイミングで実行するかを説明]
```

### Then（検証フェーズ）のコメント

```typescript
// 【結果検証】: [何を検証するかを具体的に説明]
// 【期待値確認】: [期待される結果とその理由を説明]
// 【品質保証】: [この検証がシステム品質にどう貢献するかを説明]
```

### 各expectステートメントのコメント

```typescript
// 【検証項目】: [この検証で確認している具体的な項目]
// 🟢🟡🔴 この内容の信頼性レベルを記載
expect(result.success).toBe(true); // 【確認内容】: 新フォーマット読み込みが正常に完了することを確認
expect(result.metadata.name).toBe('テストプリセット集'); // 【確認内容】: メタデータのname要素が正確に抽出されることを確認
```

### セットアップ・クリーンアップのコメント

```typescript
beforeEach(() => {
  // 【テスト前準備】: 各テスト実行前のメタデータマネージャー初期化
  // 【環境初期化】: Chrome Storage モックの状態をクリーンにする
});

afterEach(() => {
  // 【テスト後処理】: テスト実行後のメモリクリーンアップ
  // 【状態復元】: 次のテストに影響しないよう一時ファイルを削除
});
```

## 品質判定

### ✅ 高品質達成

- **テストケース分類**: 正常系（7件）・異常系（7件）・境界値（10件）を網羅（計24件）
- **期待値定義**: 各テストケースで具体的な入力値・期待値・確認ポイントを明確化
- **技術選択**: TypeScript + Vitest（既存プロジェクト準拠）で実装可能性を確実に保証
- **実装可能性**: TASK-100/101の既存基盤とEARS要件REQ-102-xxxとの完全対応

### 品質確認項目

- [x] **機能網羅性**: 新フォーマット読み込み・メタデータ管理・タグフィルタリング・互換性の全機能をカバー
- [x] **性能要件**: NFR-102-001〜003（読み込み≤200ms、フィルタ≤100ms、変換≤500ms）の検証を含む
- [x] **セキュリティ要件**: XSS攻撃防止・HTMLエスケープ・Unicode正規化の確認を含む
- [x] **境界値**: 文字数制限・タグ数制限・ファイルサイズ制限・日時・Unicode特殊文字の境界を網羅
- [x] **エラーハンドリング**: JSON構文・バージョン不一致・必須フィールド不足・リソース制限の全ケースを含む
- [x] **互換性**: レガシー形式変換・デフォルト値設定・自動修復機能の確認を含む

## TODO更新

- [x] **テストケース洗い出しフェーズ完了**
- [x] **正常系7件・異常系7件・境界値10件の計24件を定義完了**
- [x] **EARS要件REQ-102-001〜403との対応関係確立**
- [x] **TypeScript + Vitest での実装指針明確化**
- [x] **品質判定: 高品質達成（全項目クリア）**

## 次のステップ

**次のお勧めステップ**: `/tdd-red TASK-102` でRedフェーズ（失敗テスト作成）を開始します。

特に以下の優先順位での実装を推奨：

1. **新フォーマット読み込み**: TC001-TC002（基本機能の確立）
2. **メタデータ表示**: TC003-TC004（UI連携の実装）
3. **フィルタリング**: TC005-TC006（検索機能の構築）
4. **エラーハンドリング**: TC008-TC012（堅牢性の確保）
5. **境界値処理**: TC015-TC024（品質の向上）
