# TDD繝・せ繝医こ繝ｼ繧ｹ豢励＞蜃ｺ縺暦ｼ・essaging-router・・

## 譛ｬ繝峨く繝･繝｡繝ｳ繝医・縲［essaging-router・・ervice Worker蜀・Γ繝・そ繝ｼ繧ｸ繝ｫ繝ｼ繧ｿ・峨・繝・せ繝医こ繝ｼ繧ｹ荳隕ｧ縺ｧ縺吶ら峩霑代・隕∽ｻｶ螳夂ｾｩ縲∵里蟄倥ユ繧ｹ繝茨ｼ・rc/messaging-router.test.ts・峨∝梛螳夂ｾｩ縲∬ｨｭ險域ｦりｦ√↓蝓ｺ縺･縺阪∪縺吶・

## 1. 豁｣蟶ｸ邉ｻ繝・せ繝医こ繝ｼ繧ｹ・亥渕譛ｬ逧・↑蜍穂ｽ懶ｼ・

- 繝・せ繝亥錐: START_GENERATION 繧・CS 縺ｸ讖区ｸ｡縺暦ｼ・PPLY_AND_GENERATE 騾∝・・・ - 菴輔ｒ繝・せ繝医☆繧九°: START_GENERATION 繧貞女逅・＠縲¨ovelAI繧ｿ繝悶ｒ迚ｹ螳壹＠縺ｦ CS 縺ｸ APPLY_AND_GENERATE 繧帝√ｋ
  - 譛溷ｾ・＆繧後ｋ蜍穂ｽ・ `chrome.tabs.query` 縺ｧ蟇ｾ雎｡繧ｿ繝門叙蠕・竊・`chrome.tabs.sendMessage(tabId, { type: 'APPLY_AND_GENERATE', payload:{job}})` 繧・蝗樣√ｋ
- 蜈･蜉帛､: `{ type:'START_GENERATION', payload:{ job:{ id:'uuid-1', prompt:'p', params:{ steps:28 }}}}`
  - 蜈･蜉帙ョ繝ｼ繧ｿ縺ｮ諢丞袖: 譛蟆城剞縺ｮ豁｣蠖薙↑繧ｸ繝ｧ繝・- 譛溷ｾ・＆繧後ｋ邨先棡: `tabs.sendMessage` 縺梧悄蠕・ayload縺ｧ1蝗槫他縺ｰ繧後ｋ
  - 譛溷ｾ・ｵ先棡縺ｮ逅・罰: 襍ｷ蜍輔ヨ繝ｪ繧ｬ繝ｼ縺ｮ讖区ｸ｡縺励′譛蛻昴・雋ｬ蜍・- 繝・せ繝医・逶ｮ逧・ 蝓ｺ譛ｬ繝ｫ繝ｼ繝・ぅ繝ｳ繧ｰ縺ｮ謌千ｫ狗｢ｺ隱・ - 遒ｺ隱阪・繧､繝ｳ繝・ 騾∽ｿ｡蜈医ち繝蜂D繝ｻ繝｡繝・そ繝ｼ繧ｸshape繝ｻ蜻ｼ縺ｳ蜃ｺ縺怜屓謨ｰ
- 菫｡鬆ｼ諤ｧ: 泙・域里蟄倥ユ繧ｹ繝・隕∽ｻｶ縺ｫ荳閾ｴ・・
- 繝・せ繝亥錐: PROGRESS_UPDATE 繧・Popup 縺ｸ蜊ｳ譎ゅヶ繝ｭ繝ｼ繝峨く繝｣繧ｹ繝・ - 菴輔ｒ繝・せ繝医☆繧九°: 蜿礼炊縺励◆騾ｲ謐励ｒ縺昴・縺ｾ縺ｾ runtime 縺ｧ霆｢騾・ - 譛溷ｾ・＆繧後ｋ蜍穂ｽ・ `chrome.runtime.sendMessage({ type:'PROGRESS_UPDATE', payload })` 縺・蝗槫他縺ｰ繧後ｋ・医ち繧､繝槭・譛ｪ菴ｿ逕ｨ・・- 蜈･蜉帛､: `{ type:'PROGRESS_UPDATE', payload:{ jobId:'j1', status:'running', progress:{ current:1, total:3, etaSeconds:20 }}}`
  - 蜈･蜉帙ョ繝ｼ繧ｿ縺ｮ諢丞袖: 荳闊ｬ逧・↑騾ｲ謐励う繝吶Φ繝・- 譛溷ｾ・＆繧後ｋ邨先棡: runtime.sendMessage 縺悟酔荳payload縺ｧ1蝗・ - 譛溷ｾ・ｵ先棡縺ｮ逅・罰: 騾ｲ謐苓｡ｨ遉ｺ縺ｮ蜊ｳ譎よｧ繧堤｢ｺ菫・- 繝・せ繝医・逶ｮ逧・ 菴弱Ξ繧､繝・Φ繧ｷ邨瑚ｷｯ縺ｮ讀懆ｨｼ
  - 遒ｺ隱阪・繧､繝ｳ繝・ 蜻ｼ縺ｳ蜃ｺ縺怜屓謨ｰ縲｝ayload騾城℃縲√ち繧､繝槭・譛ｪ菴ｿ逕ｨ
- 菫｡鬆ｼ諤ｧ: 泙

- 繝・せ繝亥錐: IMAGE_READY 縺ｧ DOWNLOAD_IMAGE 繧貞叉譎よ欠遉ｺ
  - 菴輔ｒ繝・せ繝医☆繧九°: 逕ｻ蜒酋RL縺ｨ繝輔ぃ繧､繝ｫ蜷阪ｒ蜿礼炊縺優L繧呈欠遉ｺ
  - 譛溷ｾ・＆繧後ｋ蜍穂ｽ・ `chrome.runtime.sendMessage({ type:'DOWNLOAD_IMAGE', payload:{ url, fileName }})` 縺悟叉譎ょ他縺ｰ繧後ｋ
- 蜈･蜉帛､: `{ type:'IMAGE_READY', payload:{ jobId:'j1', url:'https://ex.com/a.png', index:0, fileName:'a.png' }}`
  - 蜈･蜉帙ョ繝ｼ繧ｿ縺ｮ諢丞袖: 豁｣蟶ｸ縺ｪ逕ｻ蜒愁L隕∵ｱ・- 譛溷ｾ・＆繧後ｋ邨先棡: DOWNLOAD_IMAGE 騾∝・1蝗槭√ち繧､繝槭・譛ｪ菴ｿ逕ｨ
  - 譛溷ｾ・ｵ先棡縺ｮ逅・罰: 螳御ｺ・､懃衍蠕後↓騾溘ｄ縺九↓DL繧帝幕蟋・- 繝・せ繝医・逶ｮ逧・ 逕滓・螳御ｺ・・菫晏ｭ倥・邨瑚ｷｯ謌千ｫ・ - 遒ｺ隱阪・繧､繝ｳ繝・ URL/繝輔ぃ繧､繝ｫ蜷阪・騾城℃諤ｧ繝ｻ蜊ｳ譎よｧ
- 菫｡鬆ｼ諤ｧ: 泙

- 繝・せ繝亥錐: OPEN_OR_FOCUS_TAB・域里蟄倥ち繝悶′縺ゅｌ縺ｰ繝輔か繝ｼ繧ｫ繧ｹ・・ - 菴輔ｒ繝・せ繝医☆繧九°: 譌｢蟄朗ovelAI繧ｿ繝悶′縺ゅｋ蝣ｴ蜷医…reate縺帙★update(active:true)
  - 譛溷ｾ・＆繧後ｋ蜍穂ｽ・ `tabs.update(id,{active:true})` 縺・蝗槭～tabs.create`縺ｯ蜻ｼ縺ｰ繧後↑縺・- 蜈･蜉帛､:`{ type:'OPEN_OR_FOCUS_TAB' }`縲～tabs.query` 縺・`[ { id:77, url:'https://novelai.net/generate' } ]` 繧定ｿ斐☆
  - 蜈･蜉帙ョ繝ｼ繧ｿ縺ｮ諢丞袖: 譌｢蟄倥ち繝匁怏繧翫・莉｣陦ｨ
- 譛溷ｾ・＆繧後ｋ邨先棡: update蜻ｼ縺ｳ蜃ｺ縺・蝗槭…reate譛ｪ蜻ｼ縺ｳ蜃ｺ縺・ - 譛溷ｾ・ｵ先棡縺ｮ逅・罰: UX/繝ｪ繧ｽ繝ｼ繧ｹ蜉ｹ邇・- 繝・せ繝医・逶ｮ逧・ 繧ｿ繝門宛蠕｡隕∽ｻｶ縺ｮ貅匁侠
  - 遒ｺ隱阪・繧､繝ｳ繝・ query邨先棡縺ｫ蠢懊§縺溷・蟯・- 菫｡鬆ｼ諤ｧ: 泯・郁ｦ∽ｻｶ/險ｭ險医°繧峨・螯･蠖捺耳貂ｬ・・
- 繝・せ繝亥錐: OPEN_OR_FOCUS_TAB・医ち繝悶′辟｡縺代ｌ縺ｰ譁ｰ隕丈ｽ懈・・・ - 菴輔ｒ繝・せ繝医☆繧九°: 譌｢蟄倥ち繝悶′辟｡縺・ｴ蜷医～tabs.create` 縺ｧ譁ｰ隕丈ｽ懈・
  - 譛溷ｾ・＆繧後ｋ蜍穂ｽ・ `tabs.create({ url:'https://novelai.net/', active:true })` 縺・蝗・- 蜈･蜉帛､: `{ type:'OPEN_OR_FOCUS_TAB' }`縲～tabs.query` 縺・`[]` 繧定ｿ斐☆
  - 蜈･蜉帙ョ繝ｼ繧ｿ縺ｮ諢丞袖: 荳榊惠繧ｱ繝ｼ繧ｹ
- 譛溷ｾ・＆繧後ｋ邨先棡: create蜻ｼ縺ｳ蜃ｺ縺・蝗・ - 譛溷ｾ・ｵ先棡縺ｮ逅・罰: 蛻晏屓襍ｷ蜍輔・荳闊ｬ蜍穂ｽ・- 繝・せ繝医・逶ｮ逧・ 蛻・ｲ千ｶｲ鄒・ - 遒ｺ隱阪・繧､繝ｳ繝・ URL/active縺ｮ謖・ｮ・- 菫｡鬆ｼ諤ｧ: 泯

- 繝・せ繝亥錐: 髱槫ｸｸ縺ｫ髟ｷ縺・prompt 縺ｧ繧よｩ区ｸ｡縺励′陦後ｏ繧後ｋ
  - 菴輔ｒ繝・せ繝医☆繧九°: 螟ｧ縺阪↑payload縺ｧ繧・START_GENERATION竊但PPLY_AND_GENERATE 縺梧・遶・ - 譛溷ｾ・＆繧後ｋ蜍穂ｽ・ `tabs.sendMessage` 縺・蝗槭・聞譁・′遐ｴ謳阪○縺夐城℃
- 蜈･蜉帛､: prompt 髟ｷ縺・10,000 縺ｮ譁・ｭ怜・
  - 蜈･蜉帙ョ繝ｼ繧ｿ縺ｮ諢丞袖: 螳滄°逕ｨ縺ｧ縺ｮ螟ｧ縺阪↑繝励Ο繝ｳ繝励ヨ
- 譛溷ｾ・＆繧後ｋ邨先棡: 蜻ｼ縺ｳ蜃ｺ縺玲・遶九・聞縺穂ｿ晄戟
  - 譛溷ｾ・ｵ先棡縺ｮ逅・罰: 螳滄°逕ｨ蠅・阜縺ｮ遒ｺ隱・- 繝・せ繝医・逶ｮ逧・ 螟ｧpayload閠先ｧ
  - 遒ｺ隱阪・繧､繝ｳ繝・ 騾∽ｿ｡蜻ｼ縺ｳ蜃ｺ縺励・謌千ｫ九→payload髟ｷ
- 菫｡鬆ｼ諤ｧ: 泙・域里蟄倥ユ繧ｹ繝医≠繧奇ｼ・

---

## 2. 逡ｰ蟶ｸ邉ｻ繝・せ繝医こ繝ｼ繧ｹ・医お繝ｩ繝ｼ繝上Φ繝峨Μ繝ｳ繧ｰ・・

- 繝・せ繝亥錐: 譛ｪ遏･繝｡繝・そ繝ｼ繧ｸ縺ｯ UNKNOWN_MESSAGE 繧ｨ繝ｩ繝ｼ
  - 繧ｨ繝ｩ繝ｼ繧ｱ繝ｼ繧ｹ縺ｮ讎りｦ・ 譛ｪ螳夂ｾｩ `type` 繧貞女逅・ - 繧ｨ繝ｩ繝ｼ蜃ｦ逅・・驥崎ｦ∵ｧ: 荳肴ｭ｣謫堺ｽ懃ｵ瑚ｷｯ縺ｮ驕ｮ譁ｭ
- 蜈･蜉帛､: `{ type:'UNKNOWN', payload:{} }`
  - 荳肴ｭ｣縺ｪ逅・罰: 莉墓ｧ伜､悶・繝｡繝・そ繝ｼ繧ｸ
  - 螳滄圀縺ｮ逋ｺ逕溘す繝翫Μ繧ｪ: 繝舌・繧ｸ繝ｧ繝ｳ鮨滄ｽｬ/螟夜Κ諡｡蠑ｵ縺ｮ蟷ｲ貂・- 譛溷ｾ・＆繧後ｋ邨先棡: `runtime.sendMessage({ type:'ERROR', payload:{ error:{ code:'UNKNOWN_MESSAGE' }}})`
  - 繧ｨ繝ｩ繝ｼ繝｡繝・そ繝ｼ繧ｸ縺ｮ蜀・ｮｹ: 逅・罰繧偵さ繝ｼ繝峨〒譏守､ｺ
  - 繧ｷ繧ｹ繝・Β縺ｮ螳牙・諤ｧ: 莉･髯阪・蜑ｯ菴懃畑縺ｪ縺・- 繝・せ繝医・逶ｮ逧・ 莉墓ｧ伜､匁賜髯､
  - 蜩∬ｳｪ菫晁ｨｼ縺ｮ隕ｳ轤ｹ: 螳牙・諤ｧ繝ｻ蛛･蜈ｨ諤ｧ縺ｮ諡・ｿ・- 菫｡鬆ｼ諤ｧ: 泙・域里蟄倥ユ繧ｹ繝医≠繧奇ｼ・
- 繝・せ繝亥錐: START_GENERATION 縺ｮ蠢・・payload 谺關ｽ縺ｯ INVALID_PAYLOAD
  - 繧ｨ繝ｩ繝ｼ繧ｱ繝ｼ繧ｹ縺ｮ讎りｦ・ `job` 谺關ｽ
  - 繧ｨ繝ｩ繝ｼ蜃ｦ逅・・驥崎ｦ∵ｧ: 荳榊ｮ悟・蜻ｽ莉､縺ｮ諡貞凄
- 蜈･蜉帛､: `{ type:'START_GENERATION', payload:{} }`
  - 荳肴ｭ｣縺ｪ逅・罰: 蠢・磯・岼荳崎ｶｳ
  - 螳滄圀縺ｮ逋ｺ逕溘す繝翫Μ繧ｪ: 繝舌げ/莠呈鋤諤ｧ蟠ｩ繧・- 譛溷ｾ・＆繧後ｋ邨先棡: `ERROR(INVALID_PAYLOAD)` 繧帝∝・
  - 繧ｨ繝ｩ繝ｼ繝｡繝・そ繝ｼ繧ｸ縺ｮ蜀・ｮｹ: 谺關ｽ繝輔ぅ繝ｼ繝ｫ繝峨ｒ遉ｺ蜚・ - 繧ｷ繧ｹ繝・Β縺ｮ螳牙・諤ｧ: 讖区ｸ｡縺玲悴螳溯｡・- 繝・せ繝医・逶ｮ逧・ 蜈･蜉帶､懆ｨｼ
  - 蜩∬ｳｪ菫晁ｨｼ縺ｮ隕ｳ轤ｹ: 蜈･蜉帛刀雉ｪ縺ｮ諡・ｿ・- 菫｡鬆ｼ諤ｧ: 泙・域里蟄倥ユ繧ｹ繝医≠繧奇ｼ・
- 繝・せ繝亥錐: PROGRESS_UPDATE 縺ｮ蠢・磯・岼谺關ｽ縺ｯ INVALID_PAYLOAD
  - 繧ｨ繝ｩ繝ｼ繧ｱ繝ｼ繧ｹ縺ｮ讎りｦ・ `jobId` 谺關ｽ
  - 繧ｨ繝ｩ繝ｼ蜃ｦ逅・・驥崎ｦ∵ｧ: 隴伜挨荳崎・繧､繝吶Φ繝医・諡貞凄
- 蜈･蜉帛､: `{ type:'PROGRESS_UPDATE', payload:{ status:'running', progress:{ current:1, total:3 } }}`
  - 荳肴ｭ｣縺ｪ逅・罰: 隴伜挨蟄舌↑縺・ - 螳滄圀縺ｮ逋ｺ逕溘す繝翫Μ繧ｪ: 繝舌げ/蜿､縺ГS
- 譛溷ｾ・＆繧後ｋ邨先棡: `ERROR(INVALID_PAYLOAD)` 繧帝∝・
  - 繧ｨ繝ｩ繝ｼ繝｡繝・そ繝ｼ繧ｸ縺ｮ蜀・ｮｹ: 谺關ｽ鬆・岼縺ｮ謖・遭
  - 繧ｷ繧ｹ繝・Β縺ｮ螳牙・諤ｧ: 繝悶Ο繝ｼ繝峨く繝｣繧ｹ繝育┌蜉ｹ蛹・- 繝・せ繝医・逶ｮ逧・ 騾ｲ謐玲､懆ｨｼ縺ｮ蝣・欧蛹・ - 蜩∬ｳｪ菫晁ｨｼ縺ｮ隕ｳ轤ｹ: 謨ｴ蜷域ｧ邯ｭ謖・- 菫｡鬆ｼ諤ｧ: 泙・域里蟄倥ユ繧ｹ繝医≠繧奇ｼ・
- 繝・せ繝亥錐: IMAGE_READY 縺ｮ蠢・磯・岼谺關ｽ縺ｯ INVALID_PAYLOAD・・rl/filename・・ - 繧ｨ繝ｩ繝ｼ繧ｱ繝ｼ繧ｹ縺ｮ讎りｦ・ 繝繧ｦ繝ｳ繝ｭ繝ｼ繝峨↓蠢・ｦ√↑諠・ｱ荳崎ｶｳ
  - 繧ｨ繝ｩ繝ｼ蜃ｦ逅・・驥崎ｦ∵ｧ: 荳肴ｭ｣DL髦ｲ豁｢
- 蜈･蜉帛､: `{ type:'IMAGE_READY', payload:{ jobId:'j1', index:0, fileName:'x.png' }}`
  - 荳肴ｭ｣縺ｪ逅・罰: url荳崎ｶｳ
  - 螳滄圀縺ｮ逋ｺ逕溘す繝翫Μ繧ｪ: CS 螳溯｣・ｸ榊ｙ
- 譛溷ｾ・＆繧後ｋ邨先棡: `ERROR(INVALID_PAYLOAD)`縲．OWNLOAD_IMAGE 縺ｯ騾√ｉ縺ｪ縺・ - 繧ｨ繝ｩ繝ｼ繝｡繝・そ繝ｼ繧ｸ縺ｮ蜀・ｮｹ: 蠢・磯・岼荳崎ｶｳ
  - 繧ｷ繧ｹ繝・Β縺ｮ螳牙・諤ｧ: 荳肴ｭ｣謫堺ｽ應ｸｭ豁｢
- 繝・せ繝医・逶ｮ逧・ DL謖・､ｺ縺ｮ髦ｲ蠕｡
  - 蜩∬ｳｪ菫晁ｨｼ縺ｮ隕ｳ轤ｹ: 繧ｻ繝ｼ繝輔ユ繧｣
- 菫｡鬆ｼ諤ｧ: 泙・域里蟄倥ユ繧ｹ繝医≠繧奇ｼ・
- 繝・せ繝亥錐: IMAGE_READY 縺ｮ荳肴ｭ｣URL縺ｯ INVALID_URL
  - 繧ｨ繝ｩ繝ｼ繧ｱ繝ｼ繧ｹ縺ｮ讎りｦ・ `javascript:` 遲峨・荳肴ｭ｣繧ｹ繧ｭ繝ｼ繝
  - 繧ｨ繝ｩ繝ｼ蜃ｦ逅・・驥崎ｦ∵ｧ: 繧ｻ繧ｭ繝･繝ｪ繝・ぅ
- 蜈･蜉帛､: `{ type:'IMAGE_READY', payload:{ jobId:'j1', url:'javascript:alert(1)', index:0, fileName:'x.png' }}`
  - 荳肴ｭ｣縺ｪ逅・罰: 蜊ｱ髯ｺ縺ｪ繧ｹ繧ｭ繝ｼ繝
  - 螳滄圀縺ｮ逋ｺ逕溘す繝翫Μ繧ｪ: XSS隱倡匱URL
- 譛溷ｾ・＆繧後ｋ邨先棡: `ERROR(INVALID_URL)`縲．OWNLOAD_IMAGE 縺ｯ騾√ｉ縺ｪ縺・ - 繧ｨ繝ｩ繝ｼ繝｡繝・そ繝ｼ繧ｸ縺ｮ蜀・ｮｹ: URL蜊ｱ髯ｺ諤ｧ縺ｮ繧ｳ繝ｼ繝牙喧
  - 繧ｷ繧ｹ繝・Β縺ｮ螳牙・諤ｧ: DL謚第ｭ｢
- 繝・せ繝医・逶ｮ逧・ URL繧ｵ繝九ち繧､繧ｺ
  - 蜩∬ｳｪ菫晁ｨｼ縺ｮ隕ｳ轤ｹ: 螳牙・諤ｧ諡・ｿ・- 菫｡鬆ｼ諤ｧ: 泙・域里蟄倥ユ繧ｹ繝医≠繧奇ｼ・
- 繝・せ繝亥錐: DOWNLOAD_FAILED 繧貞女逅・＠縺溘ｉ謖・焚繝舌ャ繧ｯ繧ｪ繝輔〒蜀崎ｩｦ陦後ｒ繧ｹ繧ｱ繧ｸ繝･繝ｼ繝ｫ
  - 繧ｨ繝ｩ繝ｼ繧ｱ繝ｼ繧ｹ縺ｮ讎りｦ・ 繝繧ｦ繝ｳ繝ｭ繝ｼ繝牙､ｱ謨励↓蟇ｾ縺怜叉譎ょ・騾√＠縺ｪ縺・ - 繧ｨ繝ｩ繝ｼ蜃ｦ逅・・驥崎ｦ∵ｧ: 豺ｷ髮代・螟ｱ謨玲凾縺ｮ螳牙ｮ壽ｧ
- 蜈･蜉帛､: `{ type:'ERROR', payload:{ error:{ code:'DOWNLOAD_FAILED' }, context:{ url, fileName } }}`
  - 荳肴ｭ｣縺ｪ逅・罰: 逶ｴ霑船L螟ｱ謨礼憾諷・ - 螳滄圀縺ｮ逋ｺ逕溘す繝翫Μ繧ｪ: 繝阪ャ繝医Ρ繝ｼ繧ｯ譁ｭ/荳譎る囿螳ｳ
- 譛溷ｾ・＆繧後ｋ邨先棡: 500ms 蠕後↓ `DOWNLOAD_IMAGE` 繧帝∝・・亥叉譎ゅ〒縺ｯ縺ｪ縺・ｼ・ - 繧ｨ繝ｩ繝ｼ繝｡繝・そ繝ｼ繧ｸ縺ｮ蜀・ｮｹ: 縺ｪ縺暦ｼ亥・驛ｨ謖吝虚・・ - 繧ｷ繧ｹ繝・Β縺ｮ螳牙・諤ｧ: 繧ｹ繝代Β騾∽ｿ｡髦ｲ豁｢
- 繝・せ繝医・逶ｮ逧・ 繝ｪ繝医Λ繧､繝昴Μ繧ｷ縺ｮ讀懆ｨｼ
  - 蜩∬ｳｪ菫晁ｨｼ縺ｮ隕ｳ轤ｹ: 蝗槫ｾｩ諤ｧ
- 菫｡鬆ｼ諤ｧ: 泯・郁ｦ∽ｻｶ/繝・せ繝医さ繝｡繝ｳ繝医・螯･蠖捺耳貂ｬ・・
- 繝・せ繝亥錐: 蜀崎ｩｦ陦御ｸ企剞蛻ｰ驕斐〒謇薙■蛻・ｊ縲・RROR 騾夂衍
  - 繧ｨ繝ｩ繝ｼ繧ｱ繝ｼ繧ｹ縺ｮ讎りｦ・ 500/1000/2000ms縺ｧ3蝗槫・隧ｦ陦悟ｾ後・謇灘・繧・ - 繧ｨ繝ｩ繝ｼ蜃ｦ逅・・驥崎ｦ∵ｧ: 辟｡髯仙・隧ｦ陦碁亟豁｢
- 蜈･蜉帛､: 蜷御ｸ翫う繝吶Φ繝医ｒ4蝗樣｣邯壽兜蜈･縲√ヵ繧ｧ繧､繧ｯ繧ｿ繧､繝槭・縺ｧ騾ｲ繧√ｋ
  - 荳肴ｭ｣縺ｪ逅・罰: 荳企剞雜・℃
  - 螳滄圀縺ｮ逋ｺ逕溘す繝翫Μ繧ｪ: 髟ｷ譎る俣髫懷ｮｳ
- 譛溷ｾ・＆繧後ｋ邨先棡: 4蝗樒岼縺ｧ霑ｽ蜉蜀埼√↑縺励～ERROR(DOWNLOAD_FAILED)` 繧帝夂衍
  - 繧ｨ繝ｩ繝ｼ繝｡繝・そ繝ｼ繧ｸ縺ｮ蜀・ｮｹ: 荳企剞蛻ｰ驕・ - 繧ｷ繧ｹ繝・Β縺ｮ螳牙・諤ｧ: 雉・ｺ先ｵｪ雋ｻ髦ｲ豁｢
- 繝・せ繝医・逶ｮ逧・ 荳企剞蛻ｶ蠕｡
  - 蜩∬ｳｪ菫晁ｨｼ縺ｮ隕ｳ轤ｹ: 螳牙ｮ壽ｧ
- 菫｡鬆ｼ諤ｧ: 泯・郁ｦ∽ｻｶ/繝・せ繝医さ繝｡繝ｳ繝医・螯･蠖捺耳貂ｬ・・

---

## 3. 蠅・阜蛟､繝・せ繝医こ繝ｼ繧ｹ・域怙蟆丞､縲∵怙螟ｧ蛟､縲］ull遲会ｼ・

- 繝・せ繝亥錐: 繝輔ぃ繧､繝ｫ蜷阪し繝九ち繧､繧ｺ・育ｦ∵ｭ｢譁・ｭ鈴勁蜴ｻ繝ｻ128譁・ｭ怜宛髯舌・諡｡蠑ｵ蟄蝉ｿ晄戟・・ - 蠅・阜蛟､縺ｮ諢丞袖: OS蛻ｶ邏・螳牙・諤ｧ
  - 蠅・阜蛟､縺ｧ縺ｮ蜍穂ｽ應ｿ晁ｨｼ: 髟ｷ螟ｧ/荳肴ｭ｣譁・ｭ玲ｷｷ蜈･縺ｧ繧ょｮ牙・蜷阪∈螟画鋤
- 蜈･蜉帛､: `fileName = 'a'.repeat(300) + ':/\\*?"<>|' + '.png'`
  - 蠅・阜蛟､驕ｸ謚槭・譬ｹ諡: 髟ｷ縺戊ｶ・℃+遖∵ｭ｢譁・ｭ励・隍・粋
  - 螳滄圀縺ｮ菴ｿ逕ｨ蝣ｴ髱｢: 髟ｷ縺・・繝ｭ繝ｳ繝励ヨ逕ｱ譚･縺ｮ蜷榊燕
- 譛溷ｾ・＆繧後ｋ邨先棡: 128譁・ｭ嶺ｻ･荳九∫ｦ∵ｭ｢譁・ｭ鈴勁蜴ｻ縲～.png` 邯ｭ謖・ - 蠅・阜縺ｧ縺ｮ豁｣遒ｺ諤ｧ: 譚｡莉ｶ貅縺溘☆譁・ｭ怜・
  - 荳雋ｫ縺励◆蜍穂ｽ・ 蟶ｸ縺ｫ蜷瑚ｦ丞援
- 繝・せ繝医・逶ｮ逧・ 繧ｵ繝九ち繧､繧ｺ蜩∬ｳｪ
  - 蝣・欧諤ｧ縺ｮ遒ｺ隱・ OS/FS莠呈鋤邯ｭ謖・- 菫｡鬆ｼ諤ｧ: 泯・郁ｦ∽ｻｶ縺ｮ螯･蠖捺耳貂ｬ + 譌｢蟄倥ユ繧ｹ繝茨ｼ・
- 繝・せ繝亥錐: 髱槫ｸｸ縺ｫ髟ｷ縺・prompt・・0,000譁・ｭ暦ｼ・ - 蠅・阜蛟､縺ｮ諢丞袖: 繝｡繝・そ繝ｼ繧ｸ繧ｵ繧､繧ｺ蠅・阜
  - 蠅・阜蛟､縺ｧ縺ｮ蜍穂ｽ應ｿ晁ｨｼ: 騾城℃邯ｭ謖・- 蜈･蜉帛､: `'p'.repeat(10_000)`
  - 蠅・阜蛟､驕ｸ謚槭・譬ｹ諡: 譌｢蟄倥ユ繧ｹ繝域ｺ匁侠
  - 螳滄圀縺ｮ菴ｿ逕ｨ蝣ｴ髱｢: 霎樊嶌/繝・Φ繝励Ξ螻暮幕
- 譛溷ｾ・＆繧後ｋ邨先棡: tabs.sendMessage 蜻ｼ縺ｳ蜃ｺ縺・蝗槭・聞縺穂ｿ晄戟
  - 蠅・阜縺ｧ縺ｮ豁｣遒ｺ諤ｧ: 蛻・ｊ謐ｨ縺ｦ繝ｻ遐ｴ謳阪↑縺・ - 荳雋ｫ縺励◆蜍穂ｽ・ 騾壼ｸｸ縺ｨ蜷後§
- 繝・せ繝医・逶ｮ逧・ 繧ｵ繧､繧ｺ閠先ｧ
  - 蝣・欧諤ｧ縺ｮ遒ｺ隱・ 荳企剞霑大ｍ縺ｧ繧ょｮ牙ｮ・- 菫｡鬆ｼ諤ｧ: 泙・域里蟄倥ユ繧ｹ繝医≠繧奇ｼ・
- 繝・せ繝亥錐: 蜀崎ｩｦ陦後せ繧ｱ繧ｸ繝･繝ｼ繝ｫ縺ｮ驕・ｻｶ蠅・阜・・00/1000/2000ms・・ - 蠅・阜蛟､縺ｮ諢丞袖: 繝舌ャ繧ｯ繧ｪ繝墓凾螳壽焚
  - 蠅・阜蛟､縺ｧ縺ｮ蜍穂ｽ應ｿ晁ｨｼ: 譛溷ｾ・←縺翫ｊ縺ｮ驕・ｻｶ
- 蜈･蜉帛､: 繝輔ぉ繧､繧ｯ繧ｿ繧､繝槭・縺ｧ 499/500/999/1000/1999/2000ms 繧帝ｲ繧√ｋ
  - 蠅・阜蛟､驕ｸ謚槭・譬ｹ諡: 縺励″縺・､逶ｴ蜑咲峩蠕・ - 螳滄圀縺ｮ菴ｿ逕ｨ蝣ｴ髱｢: 螳滄°逕ｨ縺ｧ縺ｮ驕・ｻｶ遒ｺ隱・- 譛溷ｾ・＆繧後ｋ邨先棡: 縺励″縺・､繧定ｷｨ縺・□譎らせ縺ｧ縺ｮ縺ｿ DL 蜀埼・ - 蠅・阜縺ｧ縺ｮ豁｣遒ｺ諤ｧ: 繧ｿ繧､繝溘Φ繧ｰ蜴ｳ蟇・ - 荳雋ｫ縺励◆蜍穂ｽ・ 蜷・ｮｵ髫弱〒蜷瑚ｦ丞援
- 繝・せ繝医・逶ｮ逧・ 繧ｿ繧､繝溘Φ繧ｰ豁｣遒ｺ諤ｧ
  - 蝣・欧諤ｧ縺ｮ遒ｺ隱・ 譎る俣邂｡逅・・豁｣遒ｺ諤ｧ
- 菫｡鬆ｼ諤ｧ: 泯・郁ｦ∽ｻｶ縺ｮ螯･蠖捺耳貂ｬ + 譌｢蟄倥ユ繧ｹ繝茨ｼ・
- 繝・せ繝亥錐: NovelAI繧ｿ繝門ｭ伜惠譛臥┌縺ｮ蛻・崛
  - 蠅・阜蛟､縺ｮ諢丞袖: query邨先棡縺ｮ蛻・ｲ・ - 蠅・阜蛟､縺ｧ縺ｮ蜍穂ｽ應ｿ晁ｨｼ: 蛻・ｲ舌↓蠢懊§縺・create/update 縺ｮ豁｣遒ｺ諤ｧ
- 蜈･蜉帛､: `tabs.query` 縺・`[]` 縺ｨ `[ { id } ]` 縺ｮ荳｡譁ｹ
  - 蠅・阜蛟､驕ｸ謚槭・譬ｹ諡: 蛻・ｲ千ｶｲ鄒・ - 螳滄圀縺ｮ菴ｿ逕ｨ蝣ｴ髱｢: 蛻晏屓/蜀崎ｨｪ
- 譛溷ｾ・＆繧後ｋ邨先棡: 譛溷ｾ・←縺翫ｊ縺ｮ API 蜻ｼ縺ｳ蛻・￠
  - 蠅・阜縺ｧ縺ｮ豁｣遒ｺ諤ｧ: 隱､蜻ｼ縺ｳ蜃ｺ縺励↑縺・ - 荳雋ｫ縺励◆蜍穂ｽ・ 蟶ｸ縺ｫ蜷瑚ｦ丞援
- 繝・せ繝医・逶ｮ逧・ 蛻・ｲ千ｶｲ鄒・ - 蝣・欧諤ｧ縺ｮ遒ｺ隱・ 萓句､悶・蟆代↑縺・- 菫｡鬆ｼ諤ｧ: 泯

---

## 髢狗匱險隱槭・繝輔Ξ繝ｼ繝繝ｯ繝ｼ繧ｯ

- 繝励Ο繧ｰ繝ｩ繝溘Φ繧ｰ險隱・ TypeScript
  - 險隱樣∈謚槭・逅・罰: 譌｢蟄倥さ繝ｼ繝・蝙句ｮ夂ｾｩ・・rc/types.ts・峨→繝・せ繝医′TS縺ｧ邨ｱ荳縲∝梛螳牙・縺ｧ蝗槫ｸｰ髦ｲ豁｢縺ｫ譛牙茜
  - 繝・せ繝医↓驕ｩ縺励◆讖溯・: 蝙玖｣懷ｮ後・繝ｪ繝・Λ繝ｫ蝙九・蝙九ぎ繝ｼ繝峨〒繝｡繝・そ繝ｼ繧ｸshape繧呈､懆ｨｼ縺励ｄ縺吶＞
- 繝・せ繝医ヵ繝ｬ繝ｼ繝繝ｯ繝ｼ繧ｯ: Vitest
  - 繝輔Ξ繝ｼ繝繝ｯ繝ｼ繧ｯ驕ｸ謚槭・逅・罰: 譌｢蟄倥そ繝・ヨ繧｢繝・・・・itest.config.ts, test/setup.ts・峨→莠呈鋤縲゛est莠呈鋤API縺ｧ蟄ｦ鄙偵さ繧ｹ繝井ｽ・ - 繝・せ繝亥ｮ溯｡檎腸蠅・ Node + jsdom・・hrome API縺ｯ繝｢繝・け・・- 菫｡鬆ｼ諤ｧ: 泙・育樟陦後Μ繝昴ず繝医Μ讒区・縺ｫ荳閾ｴ・・

---

## 繝・せ繝医こ繝ｼ繧ｹ螳溯｣・凾縺ｮ譌･譛ｬ隱槭さ繝｡繝ｳ繝域欠驥・

蜷・ユ繧ｹ繝医〒莉･荳九・繧ｳ繝｡繝ｳ繝医ｒ險倩ｿｰ縺吶ｋ縺薙→縲・

````javascript
// 縲舌ユ繧ｹ繝育岼逧・・ [縺薙・繝・せ繝医〒菴輔ｒ遒ｺ隱阪☆繧九°繧呈律譛ｬ隱槭〒譏手ｨ肋
// 縲舌ユ繧ｹ繝亥・螳ｹ縲・ [蜈ｷ菴鍋噪縺ｫ縺ｩ縺ｮ繧医≧縺ｪ蜃ｦ逅・ｒ繝・せ繝医☆繧九°繧定ｪｬ譏讃
// 縲先悄蠕・＆繧後ｋ蜍穂ｽ懊・ [豁｣蟶ｸ縺ｫ蜍穂ｽ懊＠縺溷ｴ蜷医・邨先棡繧定ｪｬ譏讃
// 泙泯閥 縺薙・蜀・ｮｹ縺ｮ菫｡鬆ｼ諤ｧ繝ｬ繝吶Ν繧定ｨ倩ｼ・```

```javascript
// 縲舌ユ繧ｹ繝医ョ繝ｼ繧ｿ貅門ｙ縲・ [縺ｪ縺懊％縺ｮ繝・・繧ｿ繧堤畑諢上☆繧九°縺ｮ逅・罰]
// 縲仙・譛滓擅莉ｶ險ｭ螳壹・ [繝・せ繝亥ｮ溯｡悟燕縺ｮ迥ｶ諷九ｒ隱ｬ譏讃
// 縲仙燕謠先擅莉ｶ遒ｺ隱阪・ [繝・せ繝亥ｮ溯｡後↓蠢・ｦ√↑蜑肴署譚｡莉ｶ繧呈・險肋
````

```javascript
// 縲仙ｮ滄圀縺ｮ蜃ｦ逅・ｮ溯｡後・ [縺ｩ縺ｮ讖溯・/繝｡繧ｽ繝・ラ繧貞他縺ｳ蜃ｺ縺吶°繧定ｪｬ譏讃
// 縲仙・逅・・螳ｹ縲・ [螳溯｡後＆繧後ｋ蜃ｦ逅・・蜀・ｮｹ繧呈律譛ｬ隱槭〒隱ｬ譏讃
// 縲仙ｮ溯｡後ち繧､繝溘Φ繧ｰ縲・ [縺ｪ縺懊％縺ｮ繧ｿ繧､繝溘Φ繧ｰ縺ｧ螳溯｡後☆繧九°繧定ｪｬ譏讃
```

```javascript
// 縲千ｵ先棡讀懆ｨｼ縲・ [菴輔ｒ讀懆ｨｼ縺吶ｋ縺九ｒ蜈ｷ菴鍋噪縺ｫ隱ｬ譏讃
// 縲先悄蠕・､遒ｺ隱阪・ [譛溷ｾ・＆繧後ｋ邨先棡縺ｨ縺昴・逅・罰繧定ｪｬ譏讃
// 縲仙刀雉ｪ菫晁ｨｼ縲・ [縺薙・讀懆ｨｼ縺後す繧ｹ繝・Β蜩∬ｳｪ縺ｫ縺ｩ縺・ｲ｢迪ｮ縺吶ｋ縺九ｒ隱ｬ譏讃
```

````javascript
// 縲先､懆ｨｼ鬆・岼縲・ [縺薙・讀懆ｨｼ縺ｧ遒ｺ隱阪＠縺ｦ縺・ｋ蜈ｷ菴鍋噪縺ｪ鬆・岼]
// 泙泯閥 縺薙・蜀・ｮｹ縺ｮ菫｡鬆ｼ諤ｧ繝ｬ繝吶Ν繧定ｨ倩ｼ・```

```javascript
beforeEach(() => {
  // 縲舌ユ繧ｹ繝亥燕貅門ｙ縲・ [蜷・ユ繧ｹ繝亥ｮ溯｡悟燕縺ｫ陦後≧貅門ｙ菴懈･ｭ縺ｮ隱ｬ譏讃
  // 縲千腸蠅・・譛溷喧縲・ [繝・せ繝育腸蠅・ｒ繧ｯ繝ｪ繝ｼ繝ｳ縺ｪ迥ｶ諷九↓縺吶ｋ逅・罰縺ｨ譁ｹ豕評
});

afterEach(() => {
  // 縲舌ユ繧ｹ繝亥ｾ悟・逅・・ [蜷・ユ繧ｹ繝亥ｮ溯｡悟ｾ後↓陦後≧繧ｯ繝ｪ繝ｼ繝ｳ繧｢繝・・菴懈･ｭ縺ｮ隱ｬ譏讃
  // 縲千憾諷句ｾｩ蜈・・ [谺｡縺ｮ繝・せ繝医↓蠖ｱ髻ｿ縺励↑縺・ｈ縺・憾諷九ｒ蠕ｩ蜈・☆繧狗炊逕ｱ]
});
````

---

## 蜩∬ｳｪ蛻､螳夲ｼ医ユ繧ｹ繝医こ繝ｼ繧ｹ・・

笨・鬮伜刀雉ｪ

- 繝・せ繝亥・鬘・ 豁｣蟶ｸ邉ｻ繝ｻ逡ｰ蟶ｸ邉ｻ繝ｻ蠅・阜蛟､繧堤ｶｲ鄒・- 譛溷ｾ・､螳夂ｾｩ: 蜷・こ繝ｼ繧ｹ縺ｫ譛溷ｾ・虚菴懊・讀懆ｨｼ轤ｹ繧呈・險・- 謚陦馴∈謚・ TypeScript + Vitest 縺ｧ遒ｺ螳・- 螳溯｣・庄閭ｽ諤ｧ: 譌｢蟄倥・繝｢繝・け/險ｭ螳壹〒螳溯｡悟庄閭ｽ

---

## 谺｡縺ｮ繧ｹ繝・ャ繝・

谺｡縺ｮ縺雁匡繧√せ繝・ャ繝・ `/tdd-red` 縺ｧRed繝輔ぉ繝ｼ繧ｺ・亥､ｱ謨励ユ繧ｹ繝井ｽ懈・・峨ｒ髢句ｧ九＠縺ｾ縺吶・
